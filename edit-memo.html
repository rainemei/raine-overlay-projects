<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; padding: 10px; margin: 0; }
        .timer-box { background: #333; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 10px; position: sticky; top: 0; z-index: 100; }
        #timerDisplay { font-size: 32px; font-family: monospace; color: #00ffff; }
        
        .input-card { background: #2a2a2a; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #444; }
        .input-card input, .input-card textarea { width: 100%; padding: 10px; margin-bottom: 5px; border-radius: 5px; background: #333; color: white; border: 1px solid #555; box-sizing: border-box; }
        
        /* „ÉÜ„É≥„Éó„É¨„Éº„Éà„Éú„Çø„É≥ */
        .tmpl-group { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .tmpl-btn { background: #444; color: #ddd; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; }

        .memo-item { display: flex; background: #2a2a2a; margin-bottom: 8px; border-radius: 8px; align-items: center; cursor: grab; }
        .handle { padding: 15px; color: #666; font-size: 20px; }
        .memo-info { flex-grow: 1; padding: 10px; }
        .edit-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; z-index: 200; flex-direction: column; padding: 20px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="timer-box">
        <div id="timerDisplay">00:00</div>
        <button onclick="startTimer()">START</button>
        <button onclick="recordTime()" style="background:#ffc107;">Ë®òÈå≤</button>
        <button onclick="stopTimer()">STOP</button>
        <button onclick="resetTimer()">RESET</button>
    </div>

    <div class="input-card">
        <div class="tmpl-group">
            <button class="tmpl-btn" onclick="setTmpl('„ÄêÂÖ®‰ΩìÊîªÊíÉ„Äë')">ÂÖ®‰Ωì</button>
            <button class="tmpl-btn" onclick="setTmpl('„ÄêÊï£Èñã„Äë')">Êï£Èñã</button>
            <button class="tmpl-btn" onclick="setTmpl('„Äê„Çø„É≥„ÇØÂº∑ÊîªÊíÉ„Äë')">Âº∑ÊîªÊíÉ</button>
            <button class="tmpl-btn" onclick="setTmpl('„ÄêÂ±•Ë°åÊäÄ„Äë')">Â±•Ë°å</button>
        </div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="inTime" placeholder="00:00" style="width:70px;">
            <input type="text" id="inTitle" placeholder="Ê¶ÇË¶Å">
        </div>
        <textarea id="inDetail" placeholder="Ë©≥Á¥∞"></textarea>
        <button onclick="addMemo()" style="width:100%; padding:10px; background:#28a745; color:white; border:none; border-radius:5px;">ÊâãÂãïËøΩÂä†</button>
    </div>

    <div id="memoList"></div>

    <div id="editOverlay" class="edit-overlay">
        <h3>üìù „ÇÆ„Éü„ÉÉ„ÇØ‰øÆÊ≠£</h3>
        <input type="text" id="edTime" placeholder="00:00">
        <input type="text" id="edTitle" placeholder="Ê¶ÇË¶Å">
        <textarea id="edDetail" placeholder="Ë©≥Á¥∞" rows="10"></textarea>
        <button onclick="saveEdit()" style="padding:15px; background:#28a745; color:white; border:none; border-radius:10px;">‰øùÂ≠ò</button>
        <button onclick="closeEdit()" style="padding:10px; background:#666; color:white; border:none; border-radius:10px; margin-top:10px;">„Ç≠„É£„É≥„Çª„É´</button>
    </div>

    <a href="index.html" style="display:block; text-align:center; padding:20px; color:#aaa;">‚Üê HUB„Å´Êàª„Çã</a>

    <script>
        // ‚òÖFirebaseË®≠ÂÆö
        const firebaseConfig = {
            apiKey: "AIzaSyCG9-jWeEglWYEL1eYymQSI5XZjmv39-kk",
            authDomain: "raine-overlay-projects.firebaseapp.com",
            databaseURL: "https://raine-overlay-projects-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "raine-overlay-projects",
            storageBucket: "raine-overlay-projects.firebasestorage.app",
            messagingSenderId: "116002218964",
            appId: "1:116002218964:web:616f3503eaebacb4442c41"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let elapsed = 0, timerInterval, currentEditKey = null;

        function startTimer() {
            let start = Date.now() - elapsed;
            timerInterval = setInterval(() => {
                elapsed = Date.now() - start;
                document.getElementById('timerDisplay').innerText = formatTime(elapsed);
                db.ref('counter/currentTime').set(Math.floor(elapsed / 1000));
            }, 100);
        }
        function stopTimer() { clearInterval(timerInterval); timerInterval = null; }
        function resetTimer() { stopTimer(); elapsed = 0; document.getElementById('timerDisplay').innerText="00:00"; db.ref('counter/currentTime').set(0); }
        function formatTime(ms) {
            const m = Math.floor(ms / 60000);
            const s = Math.floor((ms % 60000) / 1000);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Ë®òÈå≤„Éú„Çø„É≥ÔºàÊôÇÈñì„Å†„ÅëÂç≥Â∫ß„Å´‰øùÂ≠òÔºâ
        function recordTime() {
            const timeStr = formatTime(elapsed);
            const timeSec = Math.floor(elapsed / 1000);
            db.ref('counter/savedMemos').push({ timeStr, timeSec, title: "ÔºàÊú™Ë®≠ÂÆöÔºâ", detail: "" });
        }

        function setTmpl(txt) { document.getElementById('inTitle').value = txt; }

        function addMemo() {
            const time = document.getElementById('inTime').value || "00:00";
            const parts = time.split(':');
            const timeSec = parseInt(parts[0]) * 60 + parseInt(parts[1]);
            db.ref('counter/savedMemos').push({
                timeStr: time, timeSec,
                title: document.getElementById('inTitle').value,
                detail: document.getElementById('inDetail').value
            });
            document.getElementById('inTitle').value = ""; document.getElementById('inDetail').value = "";
        }

        // „É™„Çπ„ÉàË°®Á§∫
        db.ref('counter').on('value', (s) => {
            const data = s.val() || {};
            const listDiv = document.getElementById('memoList');
            listDiv.innerHTML = "";
            const saved = data.savedMemos || {};
            const order = data.memoOrder || Object.keys(saved);
            
            order.forEach(key => {
                if(!saved[key]) return;
                const m = saved[key];
                const item = document.createElement('div');
                item.className = 'memo-item';
                item.setAttribute('data-id', key);
                item.innerHTML = `
                    <div class="handle">‚ò∞</div>
                    <div class="memo-info">
                        <span style="color:#ffd700">${m.timeStr}</span> <strong>${m.title}</strong>
                    </div>
                    <button onclick="openEdit('${key}')" style="background:none; border:none; padding:15px; color:#aaa;">‚úé</button>
                    <button onclick="deleteMemo('${key}')" style="background:none; border:none; padding:15px; color:#dc3545;">√ó</button>
                `;
                listDiv.appendChild(item);
            });
        });

        // ‰∏¶„Å≥Êõø„ÅàÊúâÂäπÂåñ
        Sortable.create(document.getElementById('memoList'), {
            handle: '.handle',
            onEnd: function() {
                const newOrder = Array.from(document.getElementById('memoList').children).map(el => el.getAttribute('data-id'));
                db.ref('counter/memoOrder').set(newOrder);
            }
        });

        function openEdit(key) {
            currentEditKey = key;
            db.ref('counter/savedMemos/'+key).once('value', (s) => {
                const d = s.val();
                document.getElementById('edTime').value = d.timeStr;
                document.getElementById('edTitle').value = d.title;
                document.getElementById('edDetail').value = d.detail;
                document.getElementById('editOverlay').style.display = 'flex';
            });
        }
        function saveEdit() {
            const time = document.getElementById('edTime').value;
            const parts = time.split(':');
            const timeSec = parseInt(parts[0]) * 60 + parseInt(parts[1]);
            db.ref('counter/savedMemos/'+currentEditKey).update({
                timeStr: time, timeSec,
                title: document.getElementById('edTitle').value,
                detail: document.getElementById('edDetail').value
            });
            closeEdit();
        }
        function closeEdit() { document.getElementById('editOverlay').style.display='none'; }
        function deleteMemo(key) { if(confirm('ÂâäÈô§Ôºü')) db.ref('counter/savedMemos/'+key).remove(); }
    </script>
</body>
</html>