<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Timeline Controller Pro v4.1</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        /* åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body { font-family: sans-serif; background: #111; color: white; padding: 0; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .fixed-header { flex-shrink: 0; background: #222; z-index: 1000; border-bottom: 1px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .scroll-content { flex-grow: 1; overflow-y: auto; padding: 10px; scroll-behavior: smooth; }

        /* ã‚¿ãƒ– */
        .tabs { display: flex; border-bottom: 1px solid #444; }
        .tab-btn { flex: 1; background: #222; color: #888; border: none; padding: 15px; font-weight: bold; cursor: pointer; }
        .tab-btn.active { background: #333; color: #00ffff; border-bottom: 3px solid #00ffff; }

        /* ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ»ã‚¿ã‚¤ãƒãƒ¼ */
        .counter-bar { display: flex; justify-content: center; gap: 20px; background: #1a1a1a; padding: 8px 0; border-bottom: 1px solid #333; }
        .counter-item { display: flex; align-items: center; gap: 10px; }
        .counter-btn { width: 35px; height: 35px; background: #444; color: white; border-radius: 4px; font-size: 20px; border: none; }
        .timer-display { text-align: center; font-family: monospace; font-size: 52px; color: #00ffff; margin: 10px 0; }

        /* æ“ä½œãƒ‘ãƒãƒ« */
        .tab-pane { display: none; padding: 15px; }
        .tab-pane.active { display: block; }
        .switch-area { display: flex; justify-content: space-around; padding: 12px; background: #2a2a2a; font-size: 13px; border-radius: 8px; margin: 0 10px 10px 10px; }
        .input-card { background: #333; padding: 15px; border-radius: 8px; }
        
        input, select, textarea { width: 100%; margin-bottom: 10px; background: #444; border: 1px solid #555; color: white; padding: 12px; box-sizing: border-box; font-size: 16px; border-radius: 4px; }
        button { cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-battle { width: calc(100% - 20px); background: #28a745; color: white; padding: 20px; font-size: 22px; margin: 0 10px 10px 10px; border: 2px solid #fff; }
        .btn-timestamp { width: calc(100% - 20px); background: #17a2b8; color: white; padding: 15px; font-size: 18px; margin: 0 10px 15px 10px; }

        /* ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ */
        .memo-item { background: #2a2a2a; padding: 12px; margin-bottom: 8px; border-radius: 8px; display: flex; align-items: center; border-left: 6px solid #ffd700; transition: 0.3s; }
        .memo-item.active-now { background: #3a3a10; border-left-color: #00ffff; transform: scale(1.02); }
        .memo-info { flex-grow: 1; cursor: pointer; }
        .memo-info b { color: #00ffff; font-size: 18px; margin-right: 5px; }
        .btn-group { display: flex; gap: 4px; }
        .btn-sm { width: 40px; height: 40px; background: #444; color: white; font-size: 12px; }
        .btn-copy { background: #4b0082; }
        
        /* MOVIEã‚¿ãƒ–å†…ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µã‚¤ã‚ºèª¿æ•´ */
        #player-container { 
        width: 80%; /* å°‘ã—å°ã•ãã™ã‚‹ */
        margin: 0 auto 10px auto; 
        aspect-ratio: 16/9; 
        background: #000; 
        }
    </style>
</head>
<body>

<div class="fixed-header">
    <div class="tabs">
        <button id="tabBtn-remote" class="tab-btn active" onclick="showTab('remote')">REMOTE</button>
        <button id="tabBtn-edit" class="tab-btn" onclick="showTab('edit')">EDIT</button>
        <button id="tabBtn-movie" class="tab-btn" onclick="showTab('movie')">ğŸ¥ MOVIE</button>
        <button id="tabBtn-manage" class="tab-btn" onclick="showTab('manage')">MANAGE</button>
    </div>

    <div class="counter-bar">
        <div class="counter-item">SET: <button class="counter-btn" onclick="addCounter('setCount', -1)">-</button><span id="display-setCount">1</span><button class="counter-btn" onclick="addCounter('setCount', 1)">+</button></div>
        <div class="counter-item" style="border-left:1px solid #444; padding-left:20px;">PULL: <button class="counter-btn" onclick="addCounter('pullCount', -1)">-</button><span id="display-pullCount">0</span><button class="counter-btn" onclick="addCounter('pullCount', 1)">+</button></div>
    </div>

    <div id="pane-remote-head" class="tab-pane active" style="padding:0;">
        <div class="timer-display" id="remoteTimer">00:00</div>
        <div style="display: flex; gap: 8px; padding: 0 10px 10px 10px;">
            <button style="flex:1; background:#444; color:white; padding:12px;" onclick="controlTimer('start')">START</button>
            <button style="flex:1; background:#ffc107; padding:12px;" onclick="controlTimer('stop')">STOP</button>
            <button style="flex:1; background:#dc3545; color:white; padding:12px;" onclick="controlTimer('reset')">RESET</button>
        </div>
        <div class="switch-area">
            <label><input type="checkbox" id="autoScroll" checked> AUTOã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«</label>
            <label><input type="checkbox" id="jumpToEdit"> è¨˜éŒ²æ™‚EDITã¸ç§»å‹•</label>
        </div>
    </div>
    
    <button id="btn-battle" class="btn-battle" onclick="battleStart()">âš”ï¸ BATTLE START</button>
    <button id="btn-quick-record" class="btn-timestamp" onclick="setCurrentTimestamp()">ğŸ•’ ã‚¯ã‚¤ãƒƒã‚¯è¨˜éŒ² / è¤‡è£½å…ˆç¢ºä¿</button>
</div>

<div class="scroll-content" id="listContainer">
    <div id="pane-edit" class="tab-pane">
        <div class="input-card">
            <div style="margin-bottom:10px; display:flex; flex-wrap:wrap; gap:4px;">
                <button class="tmpl-btn" onclick="setTmpl('ã€å…¨ä½“æ”»æ’ƒã€‘', 3)">å…¨ä½“</button>
                <button class="tmpl-btn" onclick="setTmpl('ã€å¼·æ”»æ’ƒã€‘', 3)">å¼·æ”»æ’ƒ</button>
                <button class="tmpl-btn" onclick="setTmpl('ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã‚®ãƒŸãƒƒã‚¯ã€‘', 20)">ã‚¹ãƒ†ãƒ¼ã‚¸</button>
            </div>
            <div style="display:flex; gap:8px;">
                <input type="text" id="inTime" placeholder="00:00" style="width:110px;">
                <input type="text" id="inTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" style="flex-grow:1;">
                <input type="number" id="inDuration" placeholder="ç§’æ•°" style="width:70px;" value="3">
            </div>
            <textarea id="inDetail" placeholder="è©³ç´°ãƒ¡ãƒ¢" rows="2"></textarea>
            <button id="btn-save-main" style="background:#007bff; color:white; width:100%; padding:15px; font-size:18px;" onclick="saveMemo()">ğŸ’¾ ä¿å­˜</button>
            <button id="btn-cancel-edit" style="display:none; background:#666; width:100%; margin-top:5px; padding:10px; color:white;" onclick="cancelEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div id="pane-manage" class="tab-pane">
        <div class="input-card">
            <select id="contentSelect" onchange="changeContent()"></select>
            <button style="background:#007bff; color:white; width:100%; padding:12px; margin-bottom:10px;" onclick="addContentName()">ï¼‹ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¿½åŠ </button>
            <button style="background:#dc3545; color:white; width:100%; padding:12px;" onclick="clearAllMemos()">âš ï¸ ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <div id="pane-movie" class="tab-pane">
        <div class="input-card">
            <input type="text" id="ytUrl" placeholder="YouTube URLã‚’è²¼ã‚Šä»˜ã‘" onchange="loadVideo()">
            <div id="player-container">
                <div id="player"></div>
            </div>
            
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <button style="flex:1; background:#dc3545; color:white; padding:10px;" onclick="setVideoStartOffset()">ğŸš© ã“ã“ã‚’æˆ¦é—˜é–‹å§‹(0ç§’)ã«ã™ã‚‹</button>
                <button style="flex:1; background:#17a2b8; color:white; padding:10px;" onclick="setCurrentTimestamp()">ğŸ¬ ã‚®ãƒŸãƒƒã‚¯ã‚’è¨˜éŒ²</button>
            </div>
            <p style="font-size:12px; color:#aaa; text-align:center;">â€»ç¾åœ¨ã®æˆ¦é—˜é–‹å§‹åŸºæº–: <span id="startPointDisplay">00:00:00</span></p>
        </div>
    </div>

    <div id="memoList"></div>
</div>

<script>
    // YouTube APIã®èª­ã¿è¾¼ã¿
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // â˜…Firebaseè¨­å®šï¼ˆã”è‡ªèº«ã®ã‚‚ã®ã‚’è²¼ã£ã¦ãã ã•ã„ï¼‰
    const firebaseConfig = {
        apiKey: "AIzaSyCG9-jWeEglWYEL1eYymQSI5XZjmv39-kk",
        authDomain: "raine-overlay-projects.firebaseapp.com",
        databaseURL: "https://raine-overlay-projects-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "raine-overlay-projects",
        storageBucket: "raine-overlay-projects.firebasestorage.app",
        messagingSenderId: "116002218964",
        appId: "1:116002218964:web:616f3503eaebacb4442c41"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let editingKey = null;
    let timerInterval = null;
    let currentSec = 0;

    function showTab(tabId) {
        document.querySelectorAll('.tab-pane').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tabBtn-' + tabId).classList.add('active');
        document.getElementById('pane-' + (tabId === 'remote' ? 'remote-head' : tabId)).classList.add('active');
        // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
        const isRemote = (tabId === 'remote' || tabId === 'movie');
        document.getElementById('btn-battle').style.display = (tabId === 'remote' ? "block" : "none");
        document.getElementById('btn-quick-record').style.display = isRemote ? "block" : "none";
    }

    function addCounter(type, val) { db.ref('counter/' + type).transaction(c => Math.max(0, (c || 0) + val)); }
    db.ref('counter/setCount').on('value', s => document.getElementById('display-setCount').innerText = s.val() || 1);
    db.ref('counter/pullCount').on('value', s => document.getElementById('display-pullCount').innerText = s.val() || 0);

    db.ref('counter/currentTime').on('value', (snap) => {
        currentSec = snap.val() || 0;
        const m = Math.floor(currentSec/60); const s = currentSec%60;
        document.getElementById('remoteTimer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        if(document.getElementById('autoScroll').checked) autoScrollToList(currentSec);
    });

    function controlTimer(action) {
        if(action === 'start'){
            if(timerInterval) return;
            timerInterval = setInterval(() => db.ref('counter/currentTime').transaction(t => (t||0)+1), 1000);
        } else {
            clearInterval(timerInterval); timerInterval = null;
            if(action === 'reset') db.ref('counter/currentTime').set(0);
        }
    }

    function battleStart() {
        db.ref('counter/pullCount').transaction(c => (c || 0) + 1);
        db.ref('counter/currentTime').set(0);
        controlTimer('stop'); controlTimer('start');
    }

    function autoScrollToList(sec) {
        const items = document.querySelectorAll('.memo-item');
        let target = null;
        items.forEach(el => {
            el.classList.remove('active-now');
            if(parseInt(el.getAttribute('data-sec')) <= sec) target = el;
        });
        if(target) {
            target.classList.add('active-now');
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    db.ref('contentsList').on('value', (snap) => {
        const list = snap.val() || { "default": "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ" };
        const select = document.getElementById('contentSelect');
        const lastVal = select.value;
        select.innerHTML = "";
        Object.entries(list).forEach(([id, name]) => {
            const opt = document.createElement('option'); opt.value = id; opt.innerText = name;
            select.appendChild(opt);
        });
        if(lastVal) select.value = lastVal;
        changeContent();
    });

    function changeContent() {
        const id = document.getElementById('contentSelect').value;
        db.ref('activeContentID').set(id);
        loadMemos(id);
    }

    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆãƒ¬ã‚¤ãƒ‰åãªã©ï¼‰ã‚’æ–°è¦è¿½åŠ ã™ã‚‹é–¢æ•°
    function addContentName() {
        const newName = prompt("æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šçµ¶ã‚‚ã†ã²ã¨ã¤ã®æœªæ¥ï¼‰");
        if (!newName) return;

        // Firebaseã®contentsListã«æ–°ã—ã„IDã§è¿½åŠ 
        const newRef = db.ref('contentsList').push();
        newRef.set(newName).then(() => {
            // è¿½åŠ ã—ãŸã‚‰è‡ªå‹•çš„ã«ãã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
            document.getElementById('contentSelect').value = newRef.key;
            changeContent();
            alert("ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼");
        });
    }

    // ã‚¯ã‚¤ãƒƒã‚¯è¨˜éŒ²ãƒœã‚¿ãƒ³ã‚‚ç›¸å¯¾æ™‚é–“ã§ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
    function setCurrentTimestamp() {
        const relativeSec = currentSec; // syncTimerã§è¨ˆç®—æ¸ˆã¿ã®ç›¸å¯¾ç§’
        const timeStr = formatTime(relativeSec);
        const content = document.getElementById('contentSelect').value;
        
        if(document.getElementById('jumpToEdit').checked) {
            document.getElementById('inTime').value = timeStr;
            showTab('edit');
        } else {
            db.ref(`savedMemos/${content}`).push({ 
                timeStr, 
                timeSec: relativeSec, 
                title: "ï¼ˆè¨˜éŒ²æ¸ˆï¼‰", 
                duration: 3, 
                detail: "" 
            });
        }
    }

    // è¤‡è£½æ™‚ã«Durationï¼ˆç§’æ•°ï¼‰ã‚‚å¼•ãç¶™ãã‚ˆã†ã«ä¿®æ­£
    function copyMemo(m) {
        const mTime = Math.floor(currentSec/60); const sTime = currentSec%60;
        document.getElementById('inTime').value = `${String(mTime).padStart(2,'0')}:${String(sTime).padStart(2,'0')}`;
        document.getElementById('inTitle').value = m.title;
        document.getElementById('inDuration').value = m.duration || 3;
        document.getElementById('inDetail').value = m.detail || "";
        editingKey = null;
        document.getElementById('btn-save-main').innerText = "ğŸ’¾ è¤‡è£½ã‚’ä¿å­˜";
        document.getElementById('btn-cancel-edit').style.display = "block";
        showTab('edit');
    }

    function saveMemo() {
        const content = document.getElementById('contentSelect').value;
        const timeStr = document.getElementById('inTime').value;
        const title = document.getElementById('inTitle').value;
        const duration = parseInt(document.getElementById('inDuration').value) || 3;
        if(!timeStr || !title) return;
        const data = { 
            timeStr, 
            timeSec: (parseInt(timeStr.split(':')[0])*60) + parseInt(timeStr.split(':')[1]), 
            title, 
            duration, 
            detail: document.getElementById('inDetail').value 
        };
        if(editingKey) db.ref(`savedMemos/${content}/${editingKey}`).update(data);
        else db.ref(`savedMemos/${content}`).push(data);
        cancelEdit();
    }

    function editMemo(key, m) {
        editingKey = key;
        document.getElementById('inTime').value = m.timeStr;
        document.getElementById('inTitle').value = m.title;
        document.getElementById('inDuration').value = m.duration || 3;
        document.getElementById('inDetail').value = m.detail || "";
        document.getElementById('btn-save-main').innerText = "ğŸ’¾ ãƒ¡ãƒ¢ã‚’æ›´æ–°";
        document.getElementById('btn-cancel-edit').style.display = "block";
        showTab('edit');
    }

    function cancelEdit() {
        editingKey = null;
        document.getElementById('btn-save-main').innerText = "ğŸ’¾ ä¿å­˜";
        document.getElementById('btn-cancel-edit').style.display = "none";
        document.getElementById('inTime').value = ""; document.getElementById('inTitle').value = ""; document.getElementById('inDetail').value = "";
        document.getElementById('inDuration').value = "3";
        showTab('remote');
    }

    function loadMemos(id) {
        db.ref(`savedMemos/${id}`).off();
        db.ref(`savedMemos/${id}`).on('value', (snap) => {
            const listDiv = document.getElementById('memoList');
            listDiv.innerHTML = "";
            const data = snap.val();
            if(!data) return;
            Object.entries(data).sort((a,b) => a[1].timeSec - b[1].timeSec).forEach(([key, m]) => {
                const item = document.createElement('div');
                item.className = 'memo-item'; item.setAttribute('data-sec', m.timeSec);
                item.innerHTML = `
                    <div class="memo-info" onclick="db.ref('counter/currentTime').set(${m.timeSec})">
                            <b>[${m.timeStr}]</b> <span>${m.title}</span>
                            <small>(${m.duration}s) ${m.detail || ''}</small>
                    </div>
                    <div class="btn-group">
                        <button class="btn-sm" style="background:#6a5acd;" onclick='copyContent(${JSON.stringify(m).replace(/"/g, '&quot;')})'>ã‚³</button>
                        <button class="btn-sm" style="background:#20b2aa;" onclick='pasteContent("${key}", "${m.timeStr}", ${m.timeSec})'>è²¼</button>

                        <button class="btn-sm" onclick='editMemo("${key}", ${JSON.stringify(m).replace(/"/g, '&quot;')})'>ç·¨</button>
                        <button class="btn-sm" style="background:#522;" onclick="if(confirm('å‰Šé™¤ï¼Ÿ')) db.ref('savedMemos/${id}/${key}').remove()">æ¶ˆ</button>
                    </div>`;
                listDiv.appendChild(item);
            });
        });
    }

    let clipboardMemo = null; // ã‚³ãƒ”ãƒ¼ã—ãŸä¸­èº«ã‚’ä¸€æ™‚ä¿å­˜ã™ã‚‹å¤‰æ•°

    // 1. ä¸­èº«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ï¼ˆã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ä¿å­˜ï¼‰
    function copyContent(m) {
        clipboardMemo = {
            title: m.title,
            duration: m.duration,
            detail: m.detail
        };
        alert(`ã€Œ${m.title}ã€ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ä»–ã®é …ç›®ã®ã€Œè²¼ã€ã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚`);
    }

    // 2. æ—¢å­˜ã®é …ç›®ã«ä¸­èº«ã‚’è²¼ã‚Šä»˜ã‘ã‚‹
    function pasteContent(key, mTimeStr, mTimeSec) {
        if (!clipboardMemo) {
            alert("å…ˆã«ã‚³ãƒ”ãƒ¼å…ƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        
        const content = document.getElementById('contentSelect').value;
        const data = {
            timeStr: mTimeStr,
            timeSec: mTimeSec,
            title: clipboardMemo.title,
            duration: clipboardMemo.duration,
            detail: clipboardMemo.detail
        };

        db.ref(`savedMemos/${content}/${key}`).update(data);
    }

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠæ™‚ã«ç§’æ•°ã‚‚ã‚»ãƒƒãƒˆ
    function setTmpl(title, dur) {
        document.getElementById('inTitle').value = title;
        document.getElementById('inDuration').value = dur;
    }

    let player;
    function onYouTubeIframeAPIReady() {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸåŒ–ï¼ˆæœ€åˆã¯ç©ºï¼‰
    }

    function loadVideo() {
        const url = document.getElementById('ytUrl').value;
        let videoId = "";

        // æ§˜ã€…ãªURLå½¢å¼ã‹ã‚‰IDã‚’æŠ½å‡ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
        if (url.includes('v=')) {
            videoId = url.split('v=')[1].split('&')[0];
        } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1].split('?')[0];
        } else if (url.includes('/live/')) {
            videoId = url.split('/live/')[1].split('?')[0];
        } else if (url.includes('/embed/')) {
            videoId = url.split('/embed/')[1].split('?')[0];
        }

        if (videoId) {
            if (player) {
                player.loadVideoById(videoId);
            } else {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'origin': location.origin // ã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã®ã‚ªãƒªã‚¸ãƒ³è¨­å®š
                    },
                    events: {
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
        } else {
            alert("æœ‰åŠ¹ãªYouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        }
    }

    // å‹•ç”»ã®æ™‚é–“ã¨Firebaseã‚’åŒæœŸã•ã›ã‚‹ãƒ«ãƒ¼ãƒ—
    // åŒæœŸãƒ«ãƒ¼ãƒ—ã®ä¿®æ­£ï¼ˆã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å·®ã—å¼•ã„ã¦Firebaseã«é€ã‚‹ï¼‰
    function syncTimerWithVideo() {
        if (player && typeof player.getPlayerState === 'function' && player.getPlayerState() === YT.PlayerState.PLAYING) {
            const absoluteVideoTime = Math.floor(player.getCurrentTime());
            const relativeTime = Math.max(0, absoluteVideoTime - videoOffset); // ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å¼•ã
            
            if (Math.abs(relativeTime - currentSec) > 1) {
                db.ref('counter/currentTime').set(relativeTime);
            }
        }
        requestAnimationFrame(syncTimerWithVideo);
    }

    requestAnimationFrame(syncTimerWithVideo);

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            // å†ç”Ÿé–‹å§‹æ™‚ã«åŒæœŸé–‹å§‹
        }
    }

    let videoOffset = 0; // 0ç§’åŸºæº–ã¨ã™ã‚‹å‹•ç”»ã®ç§’æ•°

    // ç§’æ•°ã‚’ hh:mm:ss ã¾ãŸã¯ mm:ss ã«å¤‰æ›ã™ã‚‹å…±é€šé–¢æ•°
    function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        const mStr = String(m).padStart(2, '0');
        const sStr = String(s).padStart(2, '0');
        return h > 0 ? `${h}:${mStr}:${sStr}` : `${mStr}:${sStr}`;
    }

    // â˜…ã“ã“ãŒé‡è¦ï¼šå‹•ç”»ã®ä»Šã®æ™‚é–“ã‚’ã€Œ0ç§’ã€ã«è¨­å®šã™ã‚‹
    function setVideoStartOffset() {
        if (!player) return;
        videoOffset = Math.floor(player.getCurrentTime());
        alert(`å‹•ç”»ã® ${formatTime(videoOffset)} ã‚’ã€Œæˆ¦é—˜é–‹å§‹(0ç§’)ã€ã«è¨­å®šã—ã¾ã—ãŸã€‚`);
        db.ref('counter/currentTime').set(0); // ã‚¿ã‚¤ãƒãƒ¼ã‚‚0ãƒªã‚»ãƒƒãƒˆ
    }

    function clearAllMemos() {
        const id = document.getElementById('contentSelect').value;
        if(confirm("å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) db.ref(`savedMemos/${id}`).remove();
    }
</script>
</body>
</html>