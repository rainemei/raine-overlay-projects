<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #222; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .current-box { background: #333; padding: 15px; border-radius: 10px; border-left: 5px solid #00ffff; margin-bottom: 20px; text-align: left; }
        input { width: 70%; padding: 12px; font-size: 16px; border-radius: 5px; border: 1px solid #555; background: #444; color: white; }
        .add-btn { padding: 12px 20px; background: #28a745; color: white; border: none; border-radius: 5px; margin-left: 5px; }
        
        .memo-list { margin-top: 30px; display: flex; flex-direction: column; gap: 10px; }
        .memo-item { display: flex; align-items: center; background: #333; border-radius: 8px; overflow: hidden; }
        .memo-text { flex-grow: 1; padding: 15px; text-align: left; cursor: pointer; }
        .memo-text:active { background: #444; }
        .del-btn { background: #dc3545; color: white; border: none; padding: 15px; width: 50px; }
        
        .back { display: block; margin-top: 40px; color: #aaa; text-decoration: none; }
    </style>
</head>
<body>
    <h2>ğŸ“ ãƒ¡ãƒ¢ç®¡ç†</h2>
    
    <div class="current-box">
        <small>ç¾åœ¨è¡¨ç¤ºä¸­:</small>
        <div id="currentMemo" style="font-size: 18px; font-weight: bold;">---</div>
    </div>

    <div style="display: flex; justify-content: center;">
        <input type="text" id="newMemoInput" placeholder="æ–°ã—ã„ãƒ¡ãƒ¢ã‚’è¿½åŠ ...">
        <button class="add-btn" onclick="addMemo()">è¿½åŠ </button>
    </div>

    <div id="memoList" class="memo-list">
        </div>

    <a href="index.html" class="back">â† æˆ»ã‚‹</a>

    <script>
        // â˜…ã”è‡ªèº«ã®Firebaseè¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
        const firebaseConfig = {
         apiKey: "AIzaSyCG9-jWeEglWYEL1eYymQSI5XZjmv39-kk",
         authDomain: "raine-overlay-projects.firebaseapp.com",
         databaseURL: "https://raine-overlay-projects-default-rtdb.asia-southeast1.firebasedatabase.app",
         projectId: "raine-overlay-projects",
         storageBucket: "raine-overlay-projects.firebasestorage.app",
         messagingSenderId: "116002218964",
         appId: "1:116002218964:web:616f3503eaebacb4442c41"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ç¾åœ¨ã®ãƒ¡ãƒ¢ã¨ã€ä¿å­˜æ¸ˆã¿ãƒªã‚¹ãƒˆã®ä¸¡æ–¹ã‚’ç›£è¦–
        db.ref('counter').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // 1. ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒ¡ãƒ¢ã‚’æ›´æ–°
            document.getElementById('currentMemo').innerText = data.memo || "---";

            // 2. ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            const listDiv = document.getElementById('memoList');
            listDiv.innerHTML = "";
            const savedMemos = data.savedMemos || {};
            
            Object.keys(savedMemos).forEach(key => {
                const text = savedMemos[key];
                const item = document.createElement('div');
                item.className = 'memo-item';
                item.innerHTML = `
                    <div class="memo-text" onclick="applyMemo('${text}')">${text}</div>
                    <button class="del-btn" onclick="deleteMemo('${key}')">Ã—</button>
                `;
                listDiv.appendChild(item);
            });
        });

        // ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹
        function addMemo() {
            const input = document.getElementById('newMemoInput');
            if (!input.value) return;
            db.ref('counter/savedMemos').push(input.value);
            input.value = "";
        }

        // ãƒªã‚¹ãƒˆã‹ã‚‰é¸ã‚“ã§OBSç”»é¢ã«åæ˜ ã™ã‚‹
        function applyMemo(text) {
            db.ref('counter').update({ memo: text });
        }

        // ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã™ã‚‹
        function deleteMemo(key) {
            if(confirm('ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                db.ref('counter/savedMemos/' + key).remove();
            }
        }
    </script>
</body>
</html>
